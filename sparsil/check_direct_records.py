#!/usr/bin/env python3
"""
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä—è–º—ã—Ö –∑–∞–ø–∏—Å–µ–π —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–π
–ó–∞–ø–∏—Å–∏ = –ª–∏–±–æ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞, –ª–∏–±–æ –æ—Ç–≤–µ—Ç –Ω–∞ —Ç–µ–º—É 489
"""

import json

def check_direct_records():
    """–ê–Ω–∞–ª–∏–∑ –ø—Ä—è–º—ã—Ö –∑–∞–ø–∏—Å–µ–π —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–π"""
    
    print("üîç –ê–ù–ê–õ–ò–ó –ü–†–Ø–ú–´–• –ó–ê–ü–ò–°–ï–ô –°–û–ë–ï–°–ï–î–û–í–ê–ù–ò–ô")
    print("=" * 60)
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    with open('telegram_topic_messages.json', 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    messages = data['messages']
    
    # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
    no_reply = []           # reply_to_msg_id = null
    reply_to_topic = []     # reply_to_msg_id = 489
    reply_to_others = []    # reply_to_msg_id = –¥—Ä—É–≥–æ–µ
    
    for msg in messages:
        reply_id = msg.get('reply_to_msg_id')
        
        if reply_id is None:
            no_reply.append(msg)
        elif reply_id == 489:
            reply_to_topic.append(msg)
        else:
            reply_to_others.append(msg)
    
    print(f"üìä –ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–Ø –°–û–û–ë–©–ï–ù–ò–ô:")
    print(f"  –ë–µ–∑ –æ—Ç–≤–µ—Ç–∞ (–ø—Ä—è–º—ã–µ): {len(no_reply)}")
    print(f"  –û—Ç–≤–µ—Ç –Ω–∞ —Ç–µ–º—É 489: {len(reply_to_topic)}")  
    print(f"  –û—Ç–≤–µ—Ç—ã –Ω–∞ –¥—Ä—É–≥–∏–µ: {len(reply_to_others)}")
    print(f"  –í—Å–µ–≥–æ: {len(messages)}")
    
    # –ü—Ä—è–º—ã–µ –∑–∞–ø–∏—Å–∏ = –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ + –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ç–µ–º—É
    direct_records = no_reply + reply_to_topic
    
    print(f"\n‚úîÔ∏è –ü–†–Ø–ú–´–ï –ó–ê–ü–ò–°–ò –°–û–ë–ï–°–ï–î–û–í–ê–ù–ò–ô: {len(direct_records)}")
    print(f"   = {len(no_reply)} –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ + {len(reply_to_topic)} –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Ç–µ–º—É")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    if no_reply:
        print(f"\nüìù –ü–†–ò–ú–ï–†–´ –°–û–û–ë–©–ï–ù–ò–ô –ë–ï–ó –û–¢–í–ï–¢–ê:")
        for i, msg in enumerate(no_reply[:3], 1):
            print(f"  {i}. ID {msg['id']}, –¥–∞—Ç–∞: {msg['date']}")
            print(f"     –¢–µ–∫—Å—Ç: {msg['text'][:150]}...")
            print()
    else:
        print(f"\n‚ùå –°–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ –ù–ï–¢")
        print(f"   –í–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–µ—Ä –ø–æ–ª—É—á–∏–ª —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç—ã, –Ω–æ –Ω–µ –ø—Ä—è–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–º—ã")
    
    if reply_to_topic:
        print(f"\nüìù –ü–†–ò–ú–ï–†–´ –û–¢–í–ï–¢–û–í –ù–ê –¢–ï–ú–£ 489:")
        for i, msg in enumerate(reply_to_topic[:3], 1):
            print(f"  {i}. ID {msg['id']}, –¥–∞—Ç–∞: {msg['date']}")
            print(f"     –¢–µ–∫—Å—Ç: {msg['text'][:150]}...")
            print()
    
    # –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    from datetime import datetime
    
    if direct_records:
        dates = []
        for msg in direct_records:
            if msg['date']:
                dates.append(datetime.fromisoformat(msg['date'].replace('Z', '+00:00')))
        
        dates.sort()
        print(f"\nüìÖ –í–†–ï–ú–ï–ù–ù–û–ï –†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–†–Ø–ú–´–• –ó–ê–ü–ò–°–ï–ô:")
        print(f"   –ü–µ—Ä–∏–æ–¥: {dates[0].strftime('%Y-%m-%d')} ‚Äî {dates[-1].strftime('%Y-%m-%d')}")
        print(f"   –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {(dates[-1] - dates[0]).days} –¥–Ω–µ–π")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
    print(f"\nü§î –ê–ù–ê–õ–ò–ó –ú–ï–¢–û–î–ê –ü–ê–†–°–ò–ù–ì–ê:")
    print(f"   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏: client.iter_messages(reply_to=489)")
    print(f"   –ü–æ–ª—É—á–∏–ª–∏: —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å reply_to_msg_id = 489")
    print(f"   –ù–ï –ø–æ–ª—É—á–∏–ª–∏: —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ reply_to_msg_id (–ø—Ä—è–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–º—ã)")
    
    if len(no_reply) == 0:
        print(f"\n‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ reply_to")
        print(f"   –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –º—ã –ù–ï –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä—è–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–º—ã")
        print(f"   –ù—É–∂–µ–Ω –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –í–°–ï–• —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–µ–º—ã")
    else:
        print(f"\n‚úîÔ∏è –î–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω—ã–µ: –µ—Å—Ç—å –∏ –ø—Ä—è–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç—ã")
    
    # –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
    print(f"\nüìã –ò–¢–û–ì–û–í–´–ô –ê–ù–ê–õ–ò–ó:")
    print(f"   üìä –ü—Ä—è–º—ã–µ –∑–∞–ø–∏—Å–∏ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–π: {len(direct_records)}")
    print(f"   üìä –û—Ç–≤–µ—Ç—ã/–æ–±—Å—É–∂–¥–µ–Ω–∏—è: {len(reply_to_others)}")
    
    if len(no_reply) == 0:
        print(f"   ‚ùå –î–∞–Ω–Ω—ã–µ –ù–ï–ü–û–õ–ù–´–ï - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø—Ä—è–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–º—ã")
        print(f"   üí° –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π API –º–µ—Ç–æ–¥")
    else:
        print(f"   ‚úîÔ∏è –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ - –µ—Å—Ç—å –ø—Ä—è–º—ã–µ –∑–∞–ø–∏—Å–∏")
    
    return len(direct_records), len(reply_to_others)

if __name__ == "__main__":
    check_direct_records() 